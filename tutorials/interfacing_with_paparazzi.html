

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Interfacing with Paparazzi &mdash; PaparazziUAV _devel documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Support" href="../support/index_support.html" />
    <link rel="prev" title="Advanced" href="advanced/index_advanced.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> PaparazziUAV
          

          
          </a>

          
            
            
              <div class="version">
                5.13
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index_quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index_user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index_developer.html">Developer Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index_tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="beginner/index_beginner.html">Beginner</a></li>
<li class="toctree-l2"><a class="reference internal" href="intermediate/index_intermediate.html">Intermediate</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced/index_advanced.html">Advanced</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Interfacing with Paparazzi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-pprzlink-with-the-ground-station">Using Pprzlink with the ground station</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-pprzlink-independently-of-the-ground-station-tools">Using Pprzlink independently of the ground station tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../support/index_support.html">Support</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PaparazziUAV</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index_tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Interfacing with Paparazzi</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/interfacing_with_paparazzi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="interfacing-with-paparazzi">
<h1>Interfacing with Paparazzi<a class="headerlink" href="#interfacing-with-paparazzi" title="Permalink to this headline">¶</a></h1>
<p>There are four ways to interact with and to extend paparazzi capabilities:</p>
<ul class="simple">
<li><p>Using Pprzlink with the current ground station tools</p></li>
<li><p>Using Pprzlink independently of the ground station tools</p></li>
<li><p>Adding a dedicated board on the drone and using Pprzlink to communicate directly with the autopilot (usually with the serial transport)</p></li>
<li><p>Adding a module to the autopilot itself</p></li>
</ul>
<p>A combination of these options can be used at the same time to achieve specific goals.</p>
<div class="section" id="using-pprzlink-with-the-ground-station">
<h2>Using Pprzlink with the ground station<a class="headerlink" href="#using-pprzlink-with-the-ground-station" title="Permalink to this headline">¶</a></h2>
<p>The easier way to interact with Paparazzi is to create a new agent as part of the ground station. All parameters and configuration files are easily accessible, making it easy to interact with the drone or display new data on the GCS. As example, the Interactive Informatics team of ENAC used it to design novel human-drone interactions for safety pilots and adaptable interactions for pilots with disabilities.</p>
<p>The pprzlink messages that will interest us are those of the <cite>ground</cite> class. Most of those messages are emited by the server that compile the data from all drones and add an abstraction layer.</p>
<p>See the message list here: <a class="reference external" href="http://docs.paparazziuav.org/latest/paparazzi_messages.html#GROUND_CLASS">http://docs.paparazziuav.org/latest/paparazzi_messages.html#GROUND_CLASS</a>.</p>
<p>This python example shows the reception and emission of messages. For the reception, we subscribe to the FLIGHT_PARAM and ENGINE_STATUS messages at lines 25 and 27 to monitor the position of the drone, its throttle level and battery voltage. For the emission, we forge, then emit an INTRUDER message in the <cite>send_dummy_intruder</cite> method to display a dummy intruder on the Ground Control Station.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python3</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Make sure to add PAPARAZZI_HOME and PAPARAZZI_SRC to your environment variables.</span>
<span class="c1"># They must point to your paparazzi directory.</span>
<span class="n">PPRZ_HOME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PAPARAZZI_HOME&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">PPRZ_HOME</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;PAPARAZZI_HOME environment variable is not set !&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PPRZ_HOME</span><span class="p">,</span> <span class="s2">&quot;var/lib/python&quot;</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">pprzlink.ivy</span> <span class="kn">import</span> <span class="n">IvyMessagesInterface</span>
<span class="kn">from</span> <span class="nn">pprzlink.message</span> <span class="kn">import</span> <span class="n">PprzMessage</span>

<span class="n">IVY_APP_NAME</span> <span class="o">=</span> <span class="s2">&quot;Basic Interfacing Test&quot;</span>  <span class="c1"># This is the name of your app on the Ivy bus</span>
<span class="n">DEFAULT_BUS</span> <span class="o">=</span> <span class="s2">&quot;127.255.255.255:2010&quot;</span>     <span class="c1"># This is your network mask, followed by the port</span>

<span class="k">class</span> <span class="nc">BasicInterfacing</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ivy_bus</span><span class="o">=</span><span class="n">DEFAULT_BUS</span><span class="p">):</span>
        <span class="c1"># start Ivy interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ivy</span> <span class="o">=</span> <span class="n">IvyMessagesInterface</span><span class="p">(</span><span class="n">agent_name</span><span class="o">=</span><span class="n">IVY_APP_NAME</span><span class="p">,</span> <span class="n">ivy_bus</span><span class="o">=</span><span class="n">ivy_bus</span><span class="p">)</span>
        <span class="c1"># subscribe to the &quot;FLIGHT_PARAM&quot; message of class &quot;ground&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ivy</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flight_param_cb</span><span class="p">,</span> <span class="n">PprzMessage</span><span class="p">(</span><span class="s1">&#39;ground&#39;</span><span class="p">,</span> <span class="s1">&#39;FLIGHT_PARAM&#39;</span><span class="p">))</span>
        <span class="c1"># subscribe to the &quot;ENGINE_STATUS&quot; message of class &quot;ground&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ivy</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine_status_cb</span><span class="p">,</span> <span class="n">PprzMessage</span><span class="p">(</span><span class="s1">&#39;ground&#39;</span><span class="p">,</span> <span class="s1">&#39;ENGINE_STATUS&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">flight_param_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AC </span><span class="si">{}</span><span class="s2"> at pos </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> and alt </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">ac_id</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">long</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">alt</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">engine_status_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AC </span><span class="si">{}</span><span class="s2"> at </span><span class="si">{}</span><span class="s2">% throttle, </span><span class="si">{}</span><span class="s2">V&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">ac_id</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">throttle</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">bat</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">send_dummy_intruder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">PprzMessage</span><span class="p">(</span><span class="s1">&#39;ground&#39;</span><span class="p">,</span> <span class="s1">&#39;INTRUDER&#39;</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DUMMY&quot;</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">43.463</span> <span class="o">+</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.2</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span><span class="o">*</span><span class="mf">1e7</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">1.273</span> <span class="o">+</span>  <span class="mf">0.001</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">0.2</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span><span class="o">*</span><span class="mf">1e7</span><span class="p">)</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;alt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;course&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="mf">0.2</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">%</span><span class="mi">360</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;speed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;climb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;itow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ivy</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">bi</span> <span class="o">=</span> <span class="n">BasicInterfacing</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">bi</span><span class="o">.</span><span class="n">send_dummy_intruder</span><span class="p">()</span>

    <span class="k">finally</span><span class="p">:</span>
        <span class="n">bi</span><span class="o">.</span><span class="n">ivy</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="using-pprzlink-independently-of-the-ground-station-tools">
<h2>Using Pprzlink independently of the ground station tools<a class="headerlink" href="#using-pprzlink-independently-of-the-ground-station-tools" title="Permalink to this headline">¶</a></h2>
<p>Do exactly the same thing as above, but listen to messages from the <cite>Telemetry</cite> class.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../support/index_support.html" class="btn btn-neutral float-right" title="Support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="advanced/index_advanced.html" class="btn btn-neutral float-left" title="Advanced" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018, Paparazzi UAV Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>