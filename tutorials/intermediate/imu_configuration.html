

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IMU Configuration &mdash; PaparazziUAV _devel documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Advanced" href="../advanced/index_advanced.html" />
    <link rel="prev" title="Create a new radio configuration" href="create_radio.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> PaparazziUAV
          

          
          </a>

          
            
            
              <div class="version">
                5.13
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index_start.html">QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index_user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guide/index_developer.html">Developer Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index_tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../beginner/index_beginner.html">Beginner</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index_intermediate.html">Intermediate</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="write_module.html">Write a New Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="create_radio.html">Create a new radio configuration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">IMU Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#accelerometer-configuration">Accelerometer configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#accelerometer-calibration">Accelerometer calibration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/index_advanced.html">Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interfacing_with_paparazzi.html">Interfacing with Paparazzi</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../support/index_support.html">Support</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PaparazziUAV</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index_tutorials.html">Tutorials</a> &raquo;</li>
        
          <li><a href="index_intermediate.html">Intermediate</a> &raquo;</li>
        
      <li>IMU Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/intermediate/imu_configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="imu-configuration">
<h1>IMU Configuration<a class="headerlink" href="#imu-configuration" title="Permalink to this headline">¶</a></h1>
<p>The IMU is used by the drone to get its attitude and its angular speed around its axis. It is composed of 3 accelerometers and 3 gyroscopes. Some chip also embbed 3 magnetometers. This device needs to be calibrated, and the drone needs to know how it is fixed to its frame.</p>
<p>See <a class="reference external" href="http://wiki.paparazziuav.org/wiki/ImuCalibration">http://wiki.paparazziuav.org/wiki/ImuCalibration</a> for more details.</p>
<p>The accelerometers and gyro calibration is relative to the physical device you have. The magneto calibration is relative to the physival device AND the environment, i.e. the drone itself (battery, GPS…).</p>
<div class="section" id="accelerometer-configuration">
<h2>Accelerometer configuration<a class="headerlink" href="#accelerometer-configuration" title="Permalink to this headline">¶</a></h2>
<p><strong>Add the IMU module</strong></p>
<p>In your airframe file in the <cite>firmware</cite> section, add the <cite>imu</cite> module corresponding to your hardware (Replace <cite>apogee</cite> in the example below.) :</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;firmware</span> <span class="na">name=</span><span class="s">&quot;fixedwing&quot;</span><span class="nt">&gt;</span>
  ...
  <span class="nt">&lt;module</span> <span class="na">name=</span><span class="s">&quot;imu&quot;</span> <span class="na">type=</span><span class="s">&quot;apogee&quot;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/firmware&gt;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Get the axis right !</strong></p>
<p>The drone must know how your IMU is oriented.</p>
<div class="figure align-center" id="id1">
<img alt="Plane axis" src="../../_images/plane_axis.png" />
<p class="caption"><span class="caption-text">Plane axis</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="accelerometer-calibration">
<h2>Accelerometer calibration<a class="headerlink" href="#accelerometer-calibration" title="Permalink to this headline">¶</a></h2>
<p>Here is the procedure:</p>
<ol class="arabic simple">
<li><p>Flash the board with your normal AP firmware (if it is not already on it.)</p></li>
<li><p>Switch to the “raw sensors” telemetry mode via GCS-&gt;Settings-&gt;Telemetry and launch “server” to record a log.</p></li>
</ol>
<div class="figure align-center" id="id2">
<img alt="How to set raw sensors telemetry" src="../../_images/raw_sensors.jpg" />
<p class="caption"><span class="caption-text">How to set raw sensors telemetry</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<ol class="arabic simple" start="3">
<li><p>Move your IMU/airframe into different positions to record relevant measurements for each axis.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>It is important that you get the min/max sensor values on each axis: turn and hold the IMU on all six sides of the ‘cube’ for about 10 seconds per IMU axis.</p></li>
<li><p>During theses 10 seconds, the IMU must be absolutely static. Don’t hold it in your hands, you will introduce too much vibrations.</p></li>
<li><p>Please note that we talk about the IMU axes here, and not the airframe axes.</p></li>
</ul>
</div></blockquote>
<div class="figure align-center" id="id3">
<img alt="Orientations during accelerometer calibration" src="../../_images/acc_calibration.jpg" />
<p class="caption"><span class="caption-text">Orientations during accelerometer calibration</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<ol class="arabic" start="4">
<li><p>Stop the server so it will write the log file (to var/logs).</p></li>
<li><p>Run the Python script on it to get your calibration coefficients and add them to your airframe file.</p>
<blockquote>
<div><ul>
<li><p>run the script:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sw/tools/calibration/calibrate.py</span> <span class="pre">-s</span> <span class="pre">ACCEL</span> <span class="pre">-p</span> <span class="pre">var/logs/YY_MM_DD__hh_mm_ss.data</span></code></p>
</div></blockquote>
</li>
<li><p>If the log file contains logs from more than one aircraft, you will need to use the <code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;ac_id&gt;</span></code> option, e.g :</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">sw/tools/calibration/calibrate.py</span> <span class="pre">-i</span> <span class="pre">50</span> <span class="pre">-s</span> <span class="pre">ACCEL</span> <span class="pre">-p</span> <span class="pre">var/logs/YY_MM_DD__hh_mm_ss.data</span></code></p>
</div></blockquote>
</li>
<li><p>If you kept the <code class="docutils literal notranslate"><span class="pre">-p</span></code> option, the script will show the plots.</p></li>
<li><p>Add (or replace) the output values from this script to the airframe file in the <cite>IMU</cite> section. For example:</p>
<blockquote>
<div><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;section</span> <span class="na">name=</span><span class="s">&quot;IMU&quot;</span> <span class="na">prefix=</span><span class="s">&quot;IMU_&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ACCEL_X_NEUTRAL&quot;</span> <span class="na">value=</span><span class="s">&quot;-40&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ACCEL_Y_NEUTRAL&quot;</span> <span class="na">value=</span><span class="s">&quot;32&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ACCEL_Z_NEUTRAL&quot;</span> <span class="na">value=</span><span class="s">&quot;-33&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ACCEL_X_SENS&quot;</span> <span class="na">value=</span><span class="s">&quot;2.45746358482&quot;</span> <span class="na">integer=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ACCEL_Y_SENS&quot;</span> <span class="na">value=</span><span class="s">&quot;2.46030721866&quot;</span> <span class="na">integer=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;define</span> <span class="na">name=</span><span class="s">&quot;ACCEL_Z_SENS&quot;</span> <span class="na">value=</span><span class="s">&quot;2.46583755829&quot;</span> <span class="na">integer=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
  ...
<span class="nt">&lt;/section&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../advanced/index_advanced.html" class="btn btn-neutral float-right" title="Advanced" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_radio.html" class="btn btn-neutral float-left" title="Create a new radio configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018, Paparazzi UAV Team

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>